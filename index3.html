

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Masterclass Showdown 2014: Class Rankings</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style>

* {
    font-family: sans-serif;
}

li {
    padding-bottom:.25em;
}

svg .pumpkin {
    fill: yellow;
    stroke: orange;
    stroke-width: 5;
 }

svg .axis path,
svg .axis line {
    fill: none;
    stroke: #444;
    shape-rendering: crispEdges;
}

svg text {
    font-family: sans-serif;
}

.caption {
    padding-top:1em;
    padding-bottom:1em;
    text-align:center;
}

div.container {
    width:800px;
    margin-left:  auto;
    margin-right: auto;
}

div.bar {
    display: inline-block;
    width: 20px;
    height: 75px;   /* We'll override this later */
    background-color: teal;
    margin-right:2px;
}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55287638-1', 'auto');
  ga('send', 'pageview');

</script>
    </head>
    <body>
    <div class="container">
        <div align=center>
        <img src="competition-web-header.png" />
        </div>
        

<p class="caption"> 

All participating classes that have started practising are listed on the leader board  below. Find your class to see where you are currently ranked. You can track the changes in ranking from week to week by hovering over a class name to highlight its progress.
<br />
<br />
Game on.  Good luck!
</p>

        <svg id="rankings" width=900 height=1600></svg>
<div align=left style="padding-top:-100px;line-height:1.25em;">
<p>
<strong>Here's a reminder of how we calculate your learner's Masterclass score:</strong>
</p>
<ul>
    <li>The Masterclass score of a learner consists of:
    <ul>
        <li>the mastery over all the exercises done by that learner in the relevant subject and grade of the class they belong to,</li>
        <li>mapped through the function 3 ^ (mastery - 1), that is three to the power of mastery minus one,</li>
        <li>multiplied by the total number of exercises done by the learner.</li>
    </ul>
    </li>

    <li>So if m is the learner's mastery in the subject and grade and n is the number of exercises done, the learner's Masterclass score is n × 3 ^ (m – 1)</li>
    <li>The Masterclass score of a class is the average of the Masterclass score of each learner in the class.</li>
</ul>
<p>
Use this formula as a guideline on how to optimize your class's ranking.
</p>

    </div>
</div>

        <script type="text/javascript">

var weekcount = 6; /* add a fake last week */
var schoolcount = 20;

var w = 700;
var h = 1600;
var max = 1600;
var padding = 100;
var colours = ["yellow", "red", "green", "blue", "orange","brown","yellow"];




/*var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);*/

var svg = d3.select("#rankings");


var dataset =
[{name:"Roedean Academy: Gr 08 PM Maths", rankings: [1,1,1,1,1], score: 5898.2626830708 },
{name:"Jeppe Girls: Gr 10U Maths SC   ", rankings: [27,3,2,2,2], score: 1941.0352272727 },
{name:"Roedean Academy: Gr 09 PM Maths", rankings: [3,2,3,3,3], score: 1533.7622392755 },
{name:"Olico: Gr 10 Maths ", rankings: [6,4,4,4,4], score: 1440.9706293706 },
{name:"Roedean Academy: Gr 10 RB Maths", rankings: [5,8,7,5,5], score: 1427.2476076555 },
{name:"Wynberg Girls' High School: GR10PS ", rankings: [2,6,6,6,6], score: 1162.7851948052 },
{name:"Roedean Academy: Gr 11 RK Maths", rankings: [9,9,5,7,7], score: 1031.1133928572 },
{name:"Herzlia: 103LJ ", rankings: [11,5,8,8,8], score: 932.2079353138 },
{name:"Herzlia: 105NM ", rankings: [23,7,9,9,9], score: 805.8987129882 },
{name:"Olico: Gr 09 Maths ", rankings: [13,11,10,10,10], score: 767.5746842584 },
{name:"Roedean Academy: Gr 11 AB Science  ", rankings: [15,13,11,11,11], score: 694.3808723832 },
{name:"Herzlia: 106NM ", rankings: [18,10,12,12,12], score: 562.3023195544 },
{name:"Wynberg Girls' High School: GR10EV ", rankings: [4,12,13,13,13], score: 441.8713166144 },
{name:"Creston College: Grade 9 PE", rankings: [10,14,14,14,14], score: 373.7519288736 },
{name:"Wynberg Girls' High School: GR10SP ", rankings: [7,16,16,15,15], score: 350.0648022432 },
{name:"Jeppe Girls: Gr 10E Maths LT   ", rankings: [14,19,19,16,16], score: 324.4483333333 },
{name:"HeronBridge: Gr 09 SE Maths", rankings: [8,15,15,17,17], score: 308.4531891454 },
{name:"Wynberg Girls' High School: GR11EV ", rankings: [20,17,17,18,18], score: 276.1657142857 },
{name:"Wynberg Girls' High School: GR10JN ", rankings: [16,18,18,19,19], score: 270.4258610954 },
{name:"Roedean School: Gr 11 Sci LK Class 1104", rankings: [42,25,27,20,20], score: 264.8879479588 },
{name:"Reddam House Atlantic Sea Board: Graham10  ", rankings: [26,20,21,21,21], score: 218.6571995909 },
{name:"Roedean Academy: Gr 10 TN Science  ", rankings: [45,32,20,22,22], score: 207.4204187264 },
{name:"Wynberg Girls' High School: GR10CU ", rankings: [12,21,22,23,23], score: 199.6101576994 },
{name:"Wynberg Girls' High School: GR11JN ", rankings: [17,22,23,24,24], score: 181.1304347826 },
{name:"Roedean Academy: Gr 12 SM Science  ", rankings: [45,28,29,25,25], score: 169.0107737305 },
{name:"Roedean School: Gr 10 Sci TN Class 1003", rankings: [43,41,24,26,26], score: 140.3210624544 },
{name:"Wynberg Girls' High School: GR10DM ", rankings: [19,23,25,27,27], score: 132.8522727273 },
{name:"Wynberg Girls' High School: GR11PS ", rankings: [24,24,26,28,28], score: 125.4886363636 },
{name:"Wynberg Girls' High School: GR11PM ", rankings: [29,27,28,29,29], score: 117.5625 },
{name:"Wynberg Girls' High School: GR11DM ", rankings: [21,26,30,30,30], score: 98.1304347826 },
{name:"Wynberg Girls' High School: GR11FB ", rankings: [22,29,31,31,31], score: 90.6785714286 },
{name:"Wynberg Girls' High School: GR10FB ", rankings: [25,30,32,32,32], score: 75.9807692308 },
{name:"HeronBridge: Gr 10 SE Maths", rankings: [35,43,33,33,33], score: 71.609149941 },
{name:"Reddam House Atlantic Sea Board: Graham12  ", rankings: [44,31,34,34,34], score: 68.4581632653 },
{name:"Wynberg Girls' High School: GR10PM ", rankings: [28,33,35,35,35], score: 55.5522077922 },
{name:"Roedean School: Gr 10 Sci TN Class 1004", rankings: [45,52,36,36,36], score: 53.1033320997 },
{name:"Creston College: Grade 11 PE   ", rankings: [45,36,40,37,37], score: 52 },
{name:"CBC St John's Parklands: Gr 10 BZ  ", rankings: [39,47,37,38,38], score: 47.327242878 },
{name:"Roedean School: Gr 10 Sci AB Class 1002", rankings: [34,37,38,39,39], score: 42.4552190685 },
{name:"Wynberg Girls' High School: GR11DB ", rankings: [30,34,39,40,40], score: 39.6458333333 },
{name:"Creston College: Grade 8 PE", rankings: [40,40,44,41,41], score: 36.4792562031 },
{name:"Durban Girls College: Gr 10 Science MP ", rankings: [31,35,41,42,42], score: 36.4615384615 },
{name:"Jeppe Girls: Gr 10D Maths AF   ", rankings: [32,38,42,43,43], score: 30.996 },
{name:"CBC St John's Parklands: Gr 11 BZ  ", rankings: [33,39,43,44,44], score: 25.9137931034 },
{name:"Jeppe Girls: Gr 11E Maths SC   ", rankings: [36,42,45,45,45], score: 20 },
{name:"Roedean School: Gr 12 Sci LK Class 1203", rankings: [45,53,54,46,46], score: 17.125 },
{name:"Roedean Academy: Gr 12 EH Maths", rankings: [45,53,52,47,47], score: 16.4796617674 },
{name:"Roedean School: Gr 11 Sci LK Class 1101", rankings: [45,53,54,48,48], score: 16.425 },
{name:"HeronBridge: Gr 08 SE Maths", rankings: [45,44,46,49,49], score: 14.9792837711 },
{name:"CBC St John's Parklands: Gr 12 BZ  ", rankings: [37,45,47,50,50], score: 9.990625 },
{name:"De La Salle: Gr 11 KVW Sci Class X ", rankings: [45,53,54,51,51], score: 9.2285714286 },
{name:"Creston College: Grade 10 PE   ", rankings: [38,46,48,52,52], score: 8.1 },
{name:"Jeppe Girls: Gr 10C Maths YS   ", rankings: [41,48,49,53,53], score: 5.8333333333 },
{name:"Covenant College: Gr 12 Maths DL   ", rankings: [45,49,50,54,54], score: 4.5 },
{name:"Reddam House Atlantic Sea Board: Graham11  ", rankings: [45,50,51,55,55], score: 4.2352941176 },
{name:"De La Salle: Gr 11 KVW Sci Class Z ", rankings: [45,53,54,56,56], score: 3.5571428571 },
{name:"Durban Girls College: Gr 10 Science HM ", rankings: [45,51,53,57,57], score: 1.1052631579 }];


var blue_to_brown = d3.scale.linear()
  .domain([1, dataset.length])
  //.range(["steelblue", "brown"])
  .range(["#0088b4", "#ef6a2c"])
  .interpolate(d3.interpolateLab);


/*
var dataset = [

];


for (var k=0; k<weekcount; k++)
{
    var rankings = d3.shuffle(d3.range(1, schoolcount+1,1));
    //var rankings = d3.range(1, schoolcount+1,1);
    for (var j=0; j<schoolcount; j++)
    {
        if (k==0) {dataset.push(
            {   
            name : "Class " + j ,
            rankings : [],
            score: 0
            }
        );}
        if (k==weekcount -1) 
            {
                dataset[j].rankings.push(dataset[j].rankings[k-1]);
                dataset[j].score = 100 - dataset[j].rankings[k-1]*4; 
            }
        else{dataset[j].rankings.push(rankings[j]);}
    }
}

dataset.sort(function(a, b) {
                 return d3.ascending(a.rankings[a.rankings.length-1], b.rankings[b.rankings.length-1]);
                            });
*/

var widths = (w)/(dataset.length);

var xScale = d3.scale.ordinal()
        .domain(d3.range(weekcount))
        .rangeRoundBands([padding, w-2*padding]);

var yScale = d3.scale.ordinal()
        .domain(d3.range(dataset.length))
        .rangeRoundBands([padding/4, max]);

var scoreScale = d3.scale.linear()
        .domain([0,dataset[0].score])
        .range([0, 100]);

var parallels = svg.selectAll("parallels")
        .data(dataset[0].rankings)
        .enter()
        .append("line")
        .attr("x1", function(d,i) {return xScale(i); })
        .attr("x2", function(d,i) {return xScale(i);})
        .attr("y1", function(d,i) {return yScale(dataset.length-1);})
        .attr("y2", function(d,i) {return yScale(0);})
        .attr("stroke-width",1)
        .attr("stroke","#111");

var weeklabels = svg.selectAll("weeklabels")
    .data(dataset[0].rankings)
    .enter()
    .append("text")
    .attr("x", function (d,i) {return xScale(i);} )
    .attr("y", function(d,i) { return yScale(0)- 20 ;} )
    .attr("font-size", 14)
    .attr("text-anchor", "middle")
    .text(function(d,i){ if (i <dataset[0].rankings.length-1) 
                            {return "Week "+ (i+1);}
                        else
                            {return "Current";}
                        });


//var scoreh =     svg.selectAll("scoresheadings")
var scoreh =     svg.append("text")
        .attr("x", xScale(dataset[0].rankings.length-1) + 400 )
        .attr("y", 13 )
        .attr("font-size", 14)
        .attr("text-anchor", "start")
        .text("Score"); 




var paths = svg.selectAll("paths")
        .data(dataset)
        .enter()
        .append("path")
        .attr("d", function(d,i) 
            {   
                var x = xScale(0);
                var y = yScale(d.rankings[0]-1);
                var result = "M "+ x + " "+ y +" L ";
                for (var j = 0; j < d.rankings.length ; j++)
                {
                    x = xScale(j);
                    y = yScale(d.rankings[j]-1);
                    result = result + x + " " + y  +",";
                }
                return result;
            })
        .attr("class",function(d,i){ return "SchoolClass" +i; })
        .attr("id",function(d,i){ return "pathSchoolClass" +i; })
        .attr("fill","none")
        .attr("stroke-width",1)
        .attr("stroke",function(d,i){ return blue_to_brown(d.rankings[d.rankings.length-1]);});
        
var labels = svg.selectAll("schools")
    .data(dataset)
    .enter()
    .append("text")
    .attr("x", function(d,i) { return xScale(d.rankings.length-1) + 15;} )
    .attr("y", function(d)   { return yScale(d.rankings[d.rankings.length-1]-1)+5;} )
//    .attr("text-anchor", "left")
    .attr("font-size", 14)
    .attr("class",function(d,i){ return "SchoolClass" +i; })
    .classed("SchoolClass",true)
    .attr("id",function(d,i){ return "SchoolClass" +i; })
    //.attr("stroke",function(d,i){ return blue_to_brown(d[d.length-1]);})
    .text(function(d,i){ return d.name;});
   

var scorebars = svg.selectAll("schools-scores")
    .data(dataset)
    .enter()
    .append("rect")
    .attr("x", function(d,i) { return xScale(dataset[0].rankings.length-1) + 400;} )
    .attr("y", function(d,i) { return yScale(i)-5;} )
    .attr("height", function(d,i) { return 10;} )
    .attr("width", function(d,i) { return  scoreScale(d.score);} )
    .attr("fill",function(d,i){ return blue_to_brown(i);})
    .attr("class",function(d,i){ return "SchoolClass" +i; })
    .attr("id",function(d,i){ return "barSchoolClass" +i; })
    .attr("stroke-width", 1)
    .attr("stroke",function(d,i){ return "gray";});
   


 
var positions = svg.selectAll("positions")
    .data(dataset)
    .enter()
    .append("text")
    .attr("x", xScale(0) - 20 )
    .attr("y", function(d,i) { return yScale(i) +7 ;} )
    .attr("font-size", 14)
    .attr("text-anchor", "end")
    .text(function(d,i){ if (i ==0 ) { return "Position: "+ (i+1); } else { return i+1;}});

var xAxis = d3.svg.axis()
                  .scale(scoreScale)
                  .orient("bottom")
                  .ticks(5);  //Set rough # of ticks



d3.selectAll(".SchoolClass")
   .on("mouseover", function() {
   var id = d3.select(this).attr("id");
   svg.selectAll("path").attr("opacity",.4);
   
   d3.select(this)
            .attr("font-weight", "bold");
   
   d3.selectAll("#path"+id)
            .attr("stroke",function(d,i){ return blue_to_brown(d.rankings[d.rankings.length-1]);})
            .attr("stroke-width", 5)
            .attr("opacity",1);

   d3.selectAll("#bar"+id)
            .attr("stroke",function(d,i){ return "black";});

   })
   .on("mouseout", function() {
        var id = d3.select(this).attr("id");
        svg.selectAll("path").attr("stroke",function(d,i){ return blue_to_brown(d.rankings[d.rankings.length-1]);})
        .attr("opacity",1);
   
        d3.selectAll("."+id)
            .attr("font-weight", "normal");
        d3.selectAll("#path"+id)
            .attr("stroke-width", 1);
        d3.selectAll("#bar"+id)
            .attr("stroke",function(d,i){ return "gray";});
    }) ;


/*
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + ((xScale(5) + 135)) + ","+( yScale(schoolcount-1)+7)+")")
    .call(xAxis);
*/
/*

var lines = svg.selectAll("lines")
        .data(dataset)
        .enter()
        .append("line")
        .attr("x1", function(d,i) {return 50+0*50;})
        .attr("y1", function(d,i) {return 50+(d[0]-1)*50;})
        .attr("x2", function(d,i) {return 50+1*50;})
        .attr("y2", function(d,i) {return 50+(d[1]-1)*50;})
        .attr("x3", function(d,i) {return 50+2*50;})
        .attr("y3", function(d,i) {return 50+(d[2]-1)*50;})
        .attr("x4", function(d,i) {return 50+3*50;})
        .attr("y4", function(d,i) {return 50+(d[3]-1)*50;})
        .attr("x5", function(d,i) {return 50+4*50;})
        .attr("y5", function(d,i) {return 50+(d[4]-1)*50;})
        .attr("x6", function(d,i) {return 50+5*50;})
        .attr("y6", function(d,i) {return 50+(d[5]-1)*50;})
        .attr("x7", function(d,i) {return 50+6*50;})
        .attr("y7", function(d,i) {return 50+(d[6]-1)*50;})
        .attr("stroke-width",2)
        .attr("stroke",function(d,i){ if (i == 0) {return "black";}else{return "red";}});
 */


        </script>

    </body>
</html> 


